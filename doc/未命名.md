背景

软件系统产生于对实际生活生产过程的电子化模拟。类比管家的概念：根据指示完成工作。其特点在于：能接收指示，能完成工作，能记录和反馈工作的执行结果；需要完成的工作可能是周期性的，也可以是临时的不定期的；工作内容可以是流程标准化的，也可能是探索性的。

系统功能描述

从不同渠道（如微信公众号一类的服务、钉钉一类的办公软件、服务直接提供的接口等）接收消息，根据消息中的指示查找相应的工作，进行执行权限和参数的验证；对验证成功的工作进行执行；并最终将工作执行结果（成功/失败及具体的结果）进行记录并由相同渠道返回。

用例：

​	用户<|--管理员

​	用户：发送消息<--include接收反馈

​	用户：接收反馈

​	管理员：管理配置，查询工作执行记录

用例业务场景描述：

发送消息/接收反馈：用户通过某个消息渠道向系统发送消息；系统从消息中提取指示（如去掉唤醒词语气词标点符号等）；并从指示中解析出需要完成的工作名称和所需参数；根据指定工作名称查询该工作的配置，配置中包括了具体的需要执行的步骤和所需要的参数；进行权限和参数完整性的校验；若校验通过，则开始执行工作，否则返回校验失败的结果；执行工作得到结果；将结果通过原消息渠道反馈给用户。

管理配置：管理员可以查看，修改，新增，删除工作配置

查询工作执行记录：管理员可以查看工作执行的记录

通用语言

消息渠道（系统接收用户调用的方式，可能是接口、即时通讯系统等）、消息（用户通过不同渠道对系统发出的调用，一般体现为自然语言，也可能是接口调用。消息的语义中包含有指示，也有可能消息本身就是指示）、指示（明确指向具体工作，并包含工作执行需要的所有参数）、工作（真实的一项需要完成的由一系列步骤构成的任务）、步骤（工作的最小组成单位）、参数（执行各步骤时必要的动态变化的内容）、结果（工作执行的产物）、权限（对用户可执行的工作范围的限定）、反馈（也是一种消息，特指从系统发送给用户的消息，一般是对用户消息的处理结果的内容）

实体梳理

聚合识别

根据上述描述，划分为消息聚合、指示聚合、工作聚合、权限聚合。其中消息聚合负责消息的接收和反馈的回复、指示的转换、以及会话的管理；指示聚合负责查找相应的工作配置，并进行参数的验证；工作聚合包含工作步骤的配置管理和实际执行，并产生执行结果；权限聚合负责对各个环节进行控制。

上下文识别

聚合边界即上下文边界

工作上下文

简述

工作模块中最重要的概念就是工作（Work）、步骤（Step）和结果（Result）。所有的指示、配置和参数等，都是为了最终执行步骤明确的工作并产生结果；与用户的交互，也是基于有工作需要被执行和有工作已经执行结束。因此工作上下文作为整个系统的核心，同时也是系统中最复杂的部分。

由于工作概念具有流程标准化的特点，因此每项工作都可以被详细的描述为一系列不同类型的步骤（如rest访问、MySQL查询、MongoDB查询、Redis查询、shell命令执行等）；但又由于工作内容的多样性，以及不同类型步骤在细节上的操作不同，因此可能会出现很多不同的细分类型步骤。同时，步骤中可能用到的各种url参数、连接资源等，也需要以适当的方式进行管理。

场景描述

常见工作通常可以归类为：通过简单的接口调用或数据库查询一些信息（如在Saas化服务下查询某个产品对应的租户信息甚至业务数据）；通过一系列接口调用、数据库查询和逻辑判断完成简单的日常运维问题原因排查（如用户是否由于权限不足而看不到某条数据，是否打卡，是否填写日志等）；通过一系列接口调用、服务器操作完成简单的运维问题处理（如数据库主从切换）等。

用例描述

外部/上游：工作增删改查、工作执行

工作执行：根据工作名称查询工作配置，参数验证，进行执行，得到执行结果

领域模型

类图结构

时序描述

配置示例